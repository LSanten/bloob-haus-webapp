{
  "version": 3,
  "sources": ["../../../../lib/visualizers/checkbox-tracker/browser.js"],
  "sourcesContent": ["/**\n * Checkbox Tracker \u2014 Browser Runtime\n *\n * Side effects: DOM manipulation, localStorage.\n * This is the only file that touches the DOM or browser APIs.\n *\n * Enables clickable checkboxes in markdown task lists with:\n * - Persistent state via localStorage\n * - Floating reset button (appears when boxes are checked)\n * - Undo window after reset (configurable, default 60 seconds)\n */\n\nconst UNDO_WINDOW_MS = 60000;\n\nfunction getStorageKey() {\n  return \"bloob-haus-checkmarks:\" + window.location.pathname;\n}\n\nfunction loadCheckboxStates() {\n  const saved = localStorage.getItem(getStorageKey());\n  return saved ? JSON.parse(saved) : {};\n}\n\nfunction saveCheckboxStates(states) {\n  const key = getStorageKey();\n  if (Object.keys(states).length === 0) {\n    localStorage.removeItem(key);\n  } else {\n    localStorage.setItem(key, JSON.stringify(states));\n  }\n}\n\nfunction hasCheckedBoxes(checkboxes) {\n  return Array.from(checkboxes).some((cb) => cb.checked);\n}\n\nfunction createFloatingButton() {\n  const button = document.createElement(\"button\");\n  button.className = \"checkbox-reset-btn\";\n  button.textContent = \"Reset checkboxes\";\n  button.type = \"button\";\n  return button;\n}\n\nfunction initCheckboxes() {\n  // Select all task list checkboxes (handles both Hugo and markdown-it-task-lists output)\n  // Hugo: ul > li > input[type=\"checkbox\"]\n  // markdown-it-task-lists: ul > li > label > input[type=\"checkbox\"]\n  const checkboxes = document.querySelectorAll(\n    '.task-list-item input[type=\"checkbox\"], ul > li > input[type=\"checkbox\"], ul > li > p > input[type=\"checkbox\"]',\n  );\n\n  if (checkboxes.length === 0) return;\n\n  // Add classes for CSS styling\n  checkboxes.forEach((checkbox) => {\n    const ul = checkbox.closest(\"ul\");\n    if (ul) ul.classList.add(\"task-list\");\n    const li = checkbox.closest(\"li\");\n    if (li) li.classList.add(\"task-list-item\");\n  });\n\n  const savedStates = loadCheckboxStates();\n  let previousStates = null;\n  let undoTimeout = null;\n  let isInUndoWindow = false;\n\n  const button = createFloatingButton();\n  document.body.appendChild(button);\n\n  // Initialize each checkbox\n  checkboxes.forEach((checkbox, index) => {\n    checkbox.removeAttribute(\"disabled\");\n\n    const checkboxId = \"checkbox-\" + index;\n    checkbox.dataset.checkboxId = checkboxId;\n\n    if (savedStates[checkboxId]) {\n      checkbox.checked = true;\n    }\n\n    checkbox.addEventListener(\"change\", function () {\n      const states = loadCheckboxStates();\n      if (this.checked) {\n        states[this.dataset.checkboxId] = true;\n      } else {\n        delete states[this.dataset.checkboxId];\n      }\n      saveCheckboxStates(states);\n\n      if (isInUndoWindow) {\n        cancelUndoWindow();\n      }\n\n      updateButtonVisibility();\n    });\n  });\n\n  function updateButtonVisibility() {\n    if (hasCheckedBoxes(checkboxes) || isInUndoWindow) {\n      button.classList.add(\"visible\");\n    } else {\n      button.classList.remove(\"visible\");\n    }\n    button.textContent = isInUndoWindow ? \"Undo clearing\" : \"Reset checkboxes\";\n  }\n\n  function cancelUndoWindow() {\n    if (undoTimeout) {\n      clearTimeout(undoTimeout);\n      undoTimeout = null;\n    }\n    isInUndoWindow = false;\n    previousStates = null;\n  }\n\n  button.addEventListener(\"click\", function () {\n    if (isInUndoWindow) {\n      // Undo: restore previous states\n      if (previousStates) {\n        checkboxes.forEach((checkbox) => {\n          checkbox.checked = !!previousStates[checkbox.dataset.checkboxId];\n        });\n        saveCheckboxStates(previousStates);\n      }\n      cancelUndoWindow();\n      updateButtonVisibility();\n    } else {\n      // Reset: clear all, start undo window\n      previousStates = loadCheckboxStates();\n      checkboxes.forEach((checkbox) => {\n        checkbox.checked = false;\n      });\n      saveCheckboxStates({});\n\n      isInUndoWindow = true;\n      updateButtonVisibility();\n\n      undoTimeout = setTimeout(() => {\n        isInUndoWindow = false;\n        previousStates = null;\n        updateButtonVisibility();\n      }, UNDO_WINDOW_MS);\n    }\n  });\n\n  updateButtonVisibility();\n}\n\n// Run when DOM is ready\nif (document.readyState === \"loading\") {\n  document.addEventListener(\"DOMContentLoaded\", initCheckboxes);\n} else {\n  initCheckboxes();\n}\n"],
  "mappings": "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",
  "names": []
}
