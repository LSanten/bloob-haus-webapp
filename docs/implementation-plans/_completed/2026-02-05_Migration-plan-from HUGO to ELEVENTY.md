# Bloob Haus Migration Plan: Hugo â†’ Eleventy

**Version:** 3.0  
**Date:** February 5, 2026  
**Status:** ğŸ”§ IN PROGRESS (M0-M2 complete)  
**Goal:** Migrate from Hugo to Eleventy using standard conventions

---

## Strategy Overview

**Parallel Migration:** Build Eleventy alongside Hugo (hugo/ stays intact until Phase M6)

**Key Decisions:**
- Standard Eleventy 3.x structure with `src/` as input directory (ESM throughout)
- Content preprocessed directly into `src/` (e.g., `src/recipes/`, `src/notes/`)
- Slugified permalinks via `eleventyComputed.js` (configurable, not hardcoded)
- Visualizers as modular self-contained packages in `lib/visualizers/`
- Eleventy `addTransform` for build-time visualizer integration
- Backlinks via `addCollection` in Eleventy config
- Documentation updates included as explicit phase

---

## Actual Folder Structure (as built)

```
bloob-haus-webapp/
â”œâ”€â”€ eleventy.config.js           â† Config at root (Eleventy 3.x standard, ESM)
â”œâ”€â”€ .eleventyignore              â† Ignores node_modules/ (needed since gitignore is disabled)
â”‚
â”œâ”€â”€ src/                         â† Eleventy input directory
â”‚   â”œâ”€â”€ _data/                   â† Global data files
â”‚   â”‚   â”œâ”€â”€ site.js              â† Site metadata + permalink settings
â”‚   â”‚   â””â”€â”€ eleventyComputed.js  â† Slugified permalinks + future backlinks
â”‚   â”‚
â”‚   â”œâ”€â”€ _includes/               â† Templates
â”‚   â”‚   â”œâ”€â”€ layouts/
â”‚   â”‚   â”‚   â”œâ”€â”€ base.njk         â† Base HTML shell
â”‚   â”‚   â”‚   â”œâ”€â”€ page.njk         â† Single page (extends base)
â”‚   â”‚   â”‚   â””â”€â”€ list.njk         â† Section listing (extends base)
â”‚   â”‚   â””â”€â”€ partials/
â”‚   â”‚       â”œâ”€â”€ head.njk         â† <head> with meta, fonts, CSS
â”‚   â”‚       â”œâ”€â”€ nav.njk          â† Auto-detected section navigation
â”‚   â”‚       â”œâ”€â”€ footer.njk
â”‚   â”‚       â”œâ”€â”€ scripts.njk      â† Visualizer JS includes
â”‚   â”‚       â””â”€â”€ backlinks.njk    â† (M5) displays backlinks
â”‚   â”‚
â”‚   â”œâ”€â”€ recipes/                 â† Generated by preprocessor (gitignored)
â”‚   â”œâ”€â”€ notes/                   â† Generated by preprocessor (gitignored)
â”‚   â”œâ”€â”€ resources/               â† Generated by preprocessor (gitignored)
â”‚   â”œâ”€â”€ lists of favorites/      â† Generated by preprocessor (gitignored)
â”‚   â”œâ”€â”€ media/                   â† Images from preprocessor (gitignored)
â”‚   â”‚
â”‚   â””â”€â”€ assets/                  â† Static assets (checked in)
â”‚       â”œâ”€â”€ css/
â”‚       â”‚   â”œâ”€â”€ main.css
â”‚       â”‚   â””â”€â”€ visualizers/
â”‚       â”‚       â””â”€â”€ checkbox-tracker.css
â”‚       â””â”€â”€ js/
â”‚           â””â”€â”€ visualizers/     â† Bundled browser code (from esbuild)
â”‚               â””â”€â”€ checkbox-tracker.js
â”‚
â”œâ”€â”€ _site/                       â† Eleventy output (gitignored)
â”‚
â”œâ”€â”€ lib/                         â† Shared code (Bloob-specific)
â”‚   â””â”€â”€ visualizers/
â”‚       â””â”€â”€ checkbox-tracker/    â† (M4) modular visualizer package
â”‚           â”œâ”€â”€ index.js         â† Exports parser + renderer
â”‚           â”œâ”€â”€ parser.js        â† Pure: HTML â†’ data
â”‚           â”œâ”€â”€ renderer.js      â† Pure: data â†’ HTML
â”‚           â”œâ”€â”€ browser.js       â† Side effects: DOM, localStorage
â”‚           â””â”€â”€ styles.css
â”‚
â”œâ”€â”€ scripts/                     â† Build preprocessing
â”‚   â”œâ”€â”€ clone-content.js         â† Clones private GitHub repo
â”‚   â”œâ”€â”€ preprocess-content.js    â† BUILD_TARGET-aware (hugo/eleventy)
â”‚   â”œâ”€â”€ build-site.js            â† --target flag (hugo/eleventy)
â”‚   â”œâ”€â”€ bundle-visualizers.js    â† (M4) esbuild for browser bundles
â”‚   â””â”€â”€ utils/                   â† All preprocessing utilities
â”‚
â”œâ”€â”€ hugo/                        â† KEEP INTACT until Phase M6
â”œâ”€â”€ content-source/              â† Cloned from GitHub (gitignored)
â”œâ”€â”€ docs/                        â† Documentation
â”œâ”€â”€ plugins-for-obsidian/
â”œâ”€â”€ .gitignore                   â† Updated for Eleventy paths
â”œâ”€â”€ package.json                 â† Updated with Eleventy scripts
â””â”€â”€ vercel.json                  â† Update in Phase M6
```

---

## Phase M0: Preparation âœ… COMPLETE

**What was done:**
- [x] Created `src/` directory structure (`_data/`, `_includes/layouts/`, `_includes/partials/`, `assets/`)
- [x] Created `lib/visualizers/checkbox-tracker/` directory
- [x] Installed `@11ty/eleventy` and `esbuild` as devDependencies
- [x] Updated `.gitignore` for `_site/`, `src/recipes/`, `src/notes/`, `src/resources/`, `src/lists of favorites/`, `src/media/`
- [x] Added npm scripts: `build:hugo`, `build:eleventy`, `dev:eleventy`, `eleventy`
- [x] Created `.eleventyignore` with `node_modules/`

---

## Phase M1: Eleventy Foundation âœ… COMPLETE

**What was done:**
- [x] Created `eleventy.config.js` (ESM `export default`, Eleventy 3.x standard)
  - `setUseGitIgnore(false)` â€” required because generated content dirs are gitignored
  - Passthrough copy for `src/assets` and `src/media` â†’ `/media/`
  - Custom filters: `dateFormat`, `truncate`, `capitalize`
  - Auto-detected `sections` collection (mirrors Hugo's `.Site.Sections`)
- [x] Created `src/_data/site.js` with title, description, url, author, year, permalink settings
- [x] Created `src/_data/eleventyComputed.js` â€” configurable slugified permalinks from filename
- [x] Ported all Hugo templates to Nunjucks:
  - `base.njk` â† `baseof.html`
  - `page.njk` â† `single.html` (extends base)
  - `list.njk` â† `list.html` (extends base)
  - `head.njk`, `nav.njk`, `footer.njk`, `scripts.njk` â† partials
- [x] Copied CSS and JS assets from Hugo
- [x] Verified test page renders with layout, CSS, and correct URLs

**Key deviation from original plan:** Content goes directly into `src/` (e.g., `src/recipes/`) instead of `src/content/`. This follows standard Eleventy convention where file path = URL path, eliminating the need for a `content/` prefix workaround.

---

## Phase M2: Preprocessing Integration âœ… COMPLETE

**What was done:**
- [x] Modified `preprocess-content.js` with `BUILD_TARGET` env var support
  - Uses lazy `getBuildTarget()` function (not module-level const) to avoid ESM import timing issue
  - Eleventy target outputs content to `src/` and media to `src/media/`
  - Adds `layout: layouts/page.njk` to frontmatter when target is eleventy
- [x] Modified `build-site.js` with `--target=` flag
  - Parses `--target=hugo` or `--target=eleventy` from CLI args
  - Sets `BUILD_TARGET` env var before calling preprocessor
  - Calls either Hugo or Eleventy build step
- [x] Verified full pipeline: `npm run build:eleventy`
  - 67 pages built, 22 media files, 0 broken links, 4 sections
  - All URLs slugified correctly (e.g., `/recipes/challah/`)

**Gotcha discovered:** ESM import timing â€” `process.env.BUILD_TARGET` must be read inside a function, not at module level, because the env var is set by `build-site.js` after importing `preprocess-content.js`.

---

## Phase M3: Template Parity

**Goal:** Match Hugo's visual output â€” homepage and section listing pages

**Time estimate:** 1-2 hours

### Tasks

- [ ] **M3.1** Set up section collections in `eleventy.config.js`
  
  ```javascript
  // Collection per section
  eleventyConfig.addCollection("recipes", function(collectionApi) {
    return collectionApi.getFilteredByGlob("src/recipes/**/*.md");
  });
  
  // Sorted by date
  eleventyConfig.addCollection("recipesByDate", function(collectionApi) {
    return collectionApi.getFilteredByGlob("src/recipes/**/*.md")
      .sort((a, b) => (b.date || 0) - (a.date || 0));
  });
  ```

- [ ] **M3.2** Create homepage `src/index.njk`
  
  Nunjucks template (not markdown) at `src/index.njk` with:
  - Site title and tagline
  - "Recent Recipes" section using `collections.recipesByDate`
  - "Resources" section if content exists
  - "View all" links per section

- [ ] **M3.3** Verify `list.njk` works for section pages
  
  The preprocessor doesn't generate section index pages (Hugo auto-generates them).
  Options:
  - Create `src/recipes/index.njk`, `src/notes/index.njk` etc. as hand-maintained files
  - Or generate them in the preprocessor
  
  Simplest: hand-create them since there are only 4 sections.

- [ ] **M3.4** Visual comparison
  - Run `npm run build:hugo` and `npm run build:eleventy` side by side
  - Compare homepage, recipe pages, section listing pages
  - Fix any styling/layout differences

**Success Criteria:**
- Homepage lists recent recipes and sections
- Section pages (e.g., `/recipes/`) list all pages in that section
- Navigation works across all pages
- Visual output matches Hugo

---

## Phase M4: Visualizer Architecture

**Goal:** Restructure checkbox-tracker as a modular, self-contained visualizer package

**Time estimate:** 2-3 hours

### Design Principles

Each visualizer is a **self-contained package** in `lib/visualizers/<name>/` with its own files. Adding a new visualizer means adding a new folder â€” no changes to Eleventy config needed.

This follows the architecture in `docs/architecture/visualizers.md`:
- `parser.js` â€” Pure function (no side effects, no DOM, no fs)
- `renderer.js` â€” Pure function (returns HTML string)
- `browser.js` â€” Side effects (DOM events, localStorage)
- `index.js` â€” Exports
- `styles.css` â€” Visualizer-specific styles

### Eleventy Integration: `addTransform`

Eleventy's `addTransform` is the standard way to post-process HTML output. It runs after markdown is rendered to HTML, so the transform receives final HTML and can modify it.

This is better than a filter because:
- Filters operate on template variables (strings before rendering)
- Transforms operate on the full rendered HTML page
- Transforms are the standard Eleventy pattern for modifying output

```javascript
// In eleventy.config.js
eleventyConfig.addTransform("visualizers", function(content) {
  if (this.page.outputPath?.endsWith(".html")) {
    // Run each registered visualizer's transform
    return runVisualizerTransforms(content);
  }
  return content;
});
```

### Visualizer Registry

A simple auto-discovery pattern â€” scan `lib/visualizers/` for folders with an `index.js`:

```javascript
// scripts/bundle-visualizers.js
import { readdirSync } from 'fs';
import { build } from 'esbuild';

const visualizerDirs = readdirSync('lib/visualizers', { withFileTypes: true })
  .filter(d => d.isDirectory())
  .map(d => d.name);

for (const name of visualizerDirs) {
  await build({
    entryPoints: [`lib/visualizers/${name}/browser.js`],
    bundle: true,
    outfile: `src/assets/js/visualizers/${name}.js`,
    format: 'iife',
  });
}
```

### Tasks

- [ ] **M4.1** Create `lib/visualizers/checkbox-tracker/parser.js`
  
  The current checkbox-tracker is runtime-only (DOM-based). For the modular pattern, we need a parser that works on HTML (since Eleventy has already rendered markdown to HTML by the time transforms run).
  
  ```javascript
  // Pure function: finds checkbox HTML in rendered output, returns data
  export function parse(html) { /* ... */ }
  ```

- [ ] **M4.2** Create `lib/visualizers/checkbox-tracker/renderer.js`
  
  ```javascript
  // Pure function: takes parsed data, returns modified HTML string
  export function render(data, options) { /* ... */ }
  ```

- [ ] **M4.3** Create `lib/visualizers/checkbox-tracker/browser.js`
  
  Extract the existing checkbox-tracker.js IIFE into the modular format.
  This is the only file with side effects (DOM, localStorage).

- [ ] **M4.4** Create `lib/visualizers/checkbox-tracker/index.js`
  
  ```javascript
  export { parse } from './parser.js';
  export { render } from './renderer.js';
  export function transform(html) {
    const data = parse(html);
    return render(data);
  }
  ```

- [ ] **M4.5** Copy styles to `lib/visualizers/checkbox-tracker/styles.css`

- [ ] **M4.6** Create `scripts/bundle-visualizers.js`
  
  Uses esbuild to bundle each visualizer's `browser.js` into `src/assets/js/visualizers/<name>.js`. Auto-discovers visualizer folders.

- [ ] **M4.7** Add `addTransform` to `eleventy.config.js`
  
  Dynamically loads all visualizers from `lib/visualizers/` and runs their `transform()` on HTML output.

- [ ] **M4.8** Update `package.json` build scripts
  
  ```json
  "build:eleventy": "node scripts/bundle-visualizers.js && node scripts/build-site.js --target=eleventy"
  ```

- [ ] **M4.9** Test: checkbox state persists, reset button works, build-time + runtime both functional

**Success Criteria:**
- Visualizer code in `lib/visualizers/checkbox-tracker/` (self-contained)
- Adding a new visualizer = adding a new folder in `lib/visualizers/`
- No changes to `eleventy.config.js` needed per visualizer
- Checkbox state persists across page loads
- Clear separation: parser (pure) / renderer (pure) / browser (side effects)

---

## Phase M5: Backlinks via Collections

**Goal:** Implement backlinks using Eleventy's `addCollection` API

**Time estimate:** 1-2 hours

### Approach

Use `addCollection` in `eleventy.config.js` to build a backlinks index. This is more reliable than `eleventyComputed.js` for backlinks because computed data runs before collections are fully resolved, which can cause circular dependency issues.

The approach:
1. First pass: read each page's source content and extract all internal links
2. Second pass: for each page, find all other pages that link to it
3. Attach backlinks data to each page

**Important:** We read source files directly from disk rather than relying on `page.template.inputContent` (which is an Eleventy internal API that may change between versions).

### Tasks

- [ ] **M5.1** Add backlinks collection to `eleventy.config.js`
  
  ```javascript
  import fs from 'fs';

  eleventyConfig.addCollection("withBacklinks", function(collectionApi) {
    const all = collectionApi.getAll();
    const linkMap = new Map();
    
    // First pass: extract links from each page's source file
    for (const page of all) {
      if (!page.inputPath.endsWith('.md')) continue;
      const source = fs.readFileSync(page.inputPath, 'utf-8');
      const links = extractLinks(source);
      linkMap.set(page.url, links);
    }
    
    // Second pass: compute backlinks
    for (const page of all) {
      page.data.backlinks = all.filter(other =>
        other.url !== page.url &&
        linkMap.get(other.url)?.some(link =>
          link.includes(page.url) || link.includes(page.fileSlug)
        )
      ).map(p => ({ url: p.url, title: p.data.title }));
    }
    
    return all;
  });
  
  function extractLinks(content) {
    const links = [];
    // Markdown links [text](url)
    const mdLinks = content.matchAll(/\[([^\]]+)\]\(([^)]+)\)/g);
    for (const m of mdLinks) links.push(m[2]);
    // Wiki links [[target]] (if any survive preprocessing)
    const wikiLinks = content.matchAll(/\[\[([^\]]+)\]\]/g);
    for (const m of wikiLinks) links.push(m[1]);
    return links;
  }
  ```

- [ ] **M5.2** Create `src/_includes/partials/backlinks.njk`
  
  ```njk
  {% if backlinks and backlinks.length > 0 %}
  <aside class="backlinks">
    <h3>Pages that link here</h3>
    <ul>
      {% for link in backlinks %}
      <li><a href="{{ link.url }}">{{ link.title }}</a></li>
      {% endfor %}
    </ul>
  </aside>
  {% endif %}
  ```

- [ ] **M5.3** Add `{% include "partials/backlinks.njk" %}` to `page.njk`

- [ ] **M5.4** Add backlinks CSS to `main.css`

- [ ] **M5.5** Test: verify Recipe A links to Recipe B â†’ Recipe B shows backlink to Recipe A

**Success Criteria:**
- Backlinks computed automatically during build
- Backlinks display on pages that are linked to
- Uses stable APIs (reads source files from disk, not Eleventy internals)

---

## Phase M6: Deployment Switchover

**Goal:** Deploy Eleventy version to production

**Time estimate:** 1-2 hours

### Tasks

- [ ] **M6.1** Full test: `npm run build:eleventy && npx serve _site`
  - Manual testing of all pages, links, images, visualizers

- [ ] **M6.2** Update `vercel.json`
  ```json
  {
    "buildCommand": "npm run build:eleventy",
    "outputDirectory": "_site",
    "framework": null
  }
  ```

- [ ] **M6.3** Push to branch, test Vercel preview deployment
- [ ] **M6.4** Compare with production (side-by-side)
- [ ] **M6.5** Merge to main
- [ ] **M6.6** Verify production deployment
- [ ] **M6.7** Test webhook (push to buffbaby repo â†’ auto-rebuild)

**Rollback plan:** Revert `vercel.json` to Hugo config and push. Hugo folder is intact until M7.

**Success Criteria:**
- buffbaby.bloob.haus serves Eleventy version
- Auto-rebuild on content changes works
- No visual regressions

---

## Phase M7: Cleanup & Documentation

**Goal:** Remove Hugo, update all documentation

**Time estimate:** 2-3 hours

### Tasks

#### Archive Hugo

- [ ] **M7.1** Create archive branch: `git checkout -b archive/hugo-version && git push`
- [ ] **M7.2** Remove `hugo/` folder
- [ ] **M7.3** `npm uninstall hugo-bin`
- [ ] **M7.4** Clean up `package.json` scripts (remove Hugo-specific)

#### Update Documentation

- [ ] **M7.5** Create `docs/implementation-plans/DECISIONS.md` (see template below)
- [ ] **M7.6** Update `docs/CLAUDE_CONTEXT.md` (folder structure, commands, "What's Working")
- [ ] **M7.7** Update `docs/architecture/visualizers.md` (dual-use pattern, `lib/visualizers/` structure)
- [ ] **M7.8** Update `docs/implementation-plans/ROADMAP.md`
- [ ] **M7.9** Update README.md

**Success Criteria:**
- Hugo folder removed from main, preserved in archive branch
- All docs reflect current Eleventy architecture

---

## DECISIONS.md Template

Create this file in Phase M7:

```markdown
# Bloob Haus Architectural Decisions

## Decision Log

### 2026-02-05: Migration from Hugo to Eleventy

**Context:**
Bloob Haus needed site-wide awareness for features like backlinks and spatial visualization.
The core vision is "visualizers that work both in the web app and in Obsidian."

**Decision:** Migrate from Hugo to Eleventy.

**Rationale:**
1. Code sharing â€” Hugo uses Go templates; Eleventy uses JS. Same parsing logic for build-time and browser.
2. Native collections â€” site-wide data access without JSON file workarounds.
3. Dual-use visualizers â€” JS throughout enables build-time + browser + Obsidian plugin.
4. Standard conventions â€” recognizable to developers.

**Trade-offs:**
- Slower builds than Hugo (~seconds vs ~milliseconds for large sites)
- Migration effort

### 2026-02-05: Visualizer Dual-Use Architecture

**Decision:** Structure all visualizers as self-contained packages:
- `parser.js` â€” Pure function: input â†’ structured data
- `renderer.js` â€” Pure function: data â†’ HTML string
- `browser.js` â€” Side effects: DOM events, localStorage
- `index.js` â€” Exports

**Rule:** Never put DOM or filesystem operations in parser or renderer.

### 2026-02-05: Standard Eleventy Folder Structure

**Decision:** Use standard Eleventy conventions with `src/` as input directory.
Content preprocessed directly into `src/` (not a nested `src/content/`).
Non-standard additions (`lib/visualizers/`, `scripts/`) are clearly separated.
```

---

## Quick Reference: Template Syntax Conversion

| Hugo (Go) | Eleventy (Nunjucks) |
|-----------|---------------------|
| `{{ .Title }}` | `{{ title }}` |
| `{{ .Content }}` | `{{ content \| safe }}` |
| `{{ .Date }}` | `{{ date }}` |
| `{{ .Permalink }}` | `{{ page.url }}` |
| `{{ .Site.Title }}` | `{{ site.title }}` |
| `{{ if .Param }}...{{ end }}` | `{% if param %}...{% endif %}` |
| `{{ range .Pages }}...{{ end }}` | `{% for page in collections.all %}...{% endfor %}` |
| `{{ partial "head.html" . }}` | `{% include "partials/head.njk" %}` |
| `{{ block "main" . }}{{ end }}` | `{% block main %}{% endblock %}` |

---

## Rollback Plan

If issues arise after deployment:

1. Revert `vercel.json` to Hugo configuration
2. Push to main
3. Site automatically rebuilds with Hugo

Hugo folder is preserved until Phase M7, so rollback is always possible during migration.
