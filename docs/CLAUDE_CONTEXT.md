# Bloob Haus - Claude Code Context

**Purpose:** Share this file at the start of each Claude Code session.  
**Last Updated:** February 5, 2026  
**Current Phase:** Migration Complete (M0-M7), Phase 2 Planning

---

## Quick Status

| Milestone | Status |
|-----------|--------|
| Phase 1: Recipe Site (Hugo) | âœ… COMPLETE |
| Hugo â†’ Eleventy Migration (M0-M7) | âœ… COMPLETE |
| Site Enhancements (RSS, sitemap, images) | âœ… COMPLETE |
| Phase 2: Enhanced Linking & API | ğŸ“‹ PLANNING |

**LIVE SITE:** https://buffbaby.bloob.haus (Buff Baby Kitchen)

---

## What This Project Is

Bloob Haus transforms Obsidian markdown vaults into hosted static websites using Eleventy.

**Current state:** buffbaby.bloob.haus is live with Leon's recipes from a private GitHub repo, powered by Eleventy 3.x with modular visualizer architecture, backlinks, RSS feed, sitemap, and optimized images.

---

## What's Working

- Full preprocessing pipeline (Obsidian â†’ Eleventy-ready markdown)
- Eleventy 3.x site with warm color theme
- Auto-deployment on content updates (Vercel)
- Custom domain with HTTPS
- Git-based date tracking
- Comment stripping for privacy
- Clickable recipe cards
- Auto-generated navigation
- Interactive checkboxes with localStorage persistence
- Backlinks (pages that link to each other)
- RSS feed (`/feed.xml`)
- Sitemap (`/sitemap.xml`)
- robots.txt
- Custom 404 page
- Image optimization (WebP + JPEG at 600w/1200w, lazy loading)
- Modular visualizer architecture with auto-discovery

**Build pipeline:**
```bash
npm run build    # Full build: bundle visualizers â†’ clone â†’ preprocess â†’ eleventy
npm run dev      # Eleventy dev server with hot reload
```

**Deployment:**
- Push to `buffbaby` repo â†’ auto-rebuild via webhook
- Push to `bloob-haus-webapp` repo â†’ auto-redeploy site

---

## Project Structure

```
bloob-haus-webapp/
â”œâ”€â”€ eleventy.config.js           âœ… Eleventy configuration (ESM)
â”œâ”€â”€ vercel.json                  âœ… Deployment config
â”œâ”€â”€ package.json                 âœ… Scripts and dependencies
â”‚
â”œâ”€â”€ src/                         â† Eleventy input directory
â”‚   â”œâ”€â”€ _data/
â”‚   â”‚   â”œâ”€â”€ site.js              âœ… Site metadata
â”‚   â”‚   â””â”€â”€ eleventyComputed.js  âœ… Slugified permalinks
â”‚   â”œâ”€â”€ _includes/
â”‚   â”‚   â”œâ”€â”€ layouts/
â”‚   â”‚   â”‚   â”œâ”€â”€ base.njk         âœ… Base HTML layout
â”‚   â”‚   â”‚   â”œâ”€â”€ page.njk         âœ… Content page layout
â”‚   â”‚   â”‚   â””â”€â”€ list.njk         âœ… Section listing layout
â”‚   â”‚   â””â”€â”€ partials/
â”‚   â”‚       â”œâ”€â”€ head.njk         âœ… <head> with meta, RSS, fonts
â”‚   â”‚       â”œâ”€â”€ nav.njk          âœ… Auto-detected section nav
â”‚   â”‚       â”œâ”€â”€ footer.njk       âœ… Site footer
â”‚   â”‚       â”œâ”€â”€ scripts.njk      âœ… Visualizer JS includes
â”‚   â”‚       â””â”€â”€ backlinks.njk    âœ… Backlinks partial
â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â”œâ”€â”€ css/main.css         âœ… Main stylesheet
â”‚   â”‚   â”œâ”€â”€ css/visualizers/     âœ… Visualizer styles (generated)
â”‚   â”‚   â””â”€â”€ js/visualizers/      âœ… Visualizer scripts (generated)
â”‚   â”œâ”€â”€ media/                   â† Images (generated by preprocessor)
â”‚   â”œâ”€â”€ index.njk                âœ… Homepage
â”‚   â”œâ”€â”€ recipes/index.njk        âœ… Recipe listing
â”‚   â”œâ”€â”€ notes/index.njk          âœ… Notes listing
â”‚   â”œâ”€â”€ resources/index.njk      âœ… Resources listing
â”‚   â”œâ”€â”€ lists-of-favorites/index.njk âœ… Favorites listing
â”‚   â”œâ”€â”€ feed.njk                 âœ… RSS/Atom feed
â”‚   â”œâ”€â”€ sitemap.njk              âœ… XML sitemap
â”‚   â”œâ”€â”€ robots.njk               âœ… robots.txt
â”‚   â”œâ”€â”€ 404.njk                  âœ… Custom 404 page
â”‚   â”œâ”€â”€ recipes/*.md             â† Generated content (gitignored)
â”‚   â”œâ”€â”€ notes/*.md               â† Generated content (gitignored)
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ lib/visualizers/             â† Visualizer source packages
â”‚   â””â”€â”€ checkbox-tracker/
â”‚       â”œâ”€â”€ manifest.json        âœ… Metadata & settings schema
â”‚       â”œâ”€â”€ index.js             âœ… Module exports (type, name, transform)
â”‚       â”œâ”€â”€ browser.js           âœ… DOM interactivity
â”‚       â””â”€â”€ styles.css           âœ… Visualizer CSS
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ clone-content.js         âœ… Clones private GitHub repo
â”‚   â”œâ”€â”€ preprocess-content.js    âœ… Orchestrates preprocessing
â”‚   â”œâ”€â”€ build-site.js            âœ… Full build pipeline
â”‚   â”œâ”€â”€ bundle-visualizers.js    âœ… esbuild bundler (auto-discovers)
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ config-reader.js         âœ… Reads Obsidian config
â”‚       â”œâ”€â”€ publish-filter.js        âœ… Dual-mode filtering
â”‚       â”œâ”€â”€ file-index-builder.js    âœ… Filename-based URLs
â”‚       â”œâ”€â”€ wiki-link-resolver.js    âœ… [[Links]] resolution
â”‚       â”œâ”€â”€ markdown-link-resolver.js âœ… Standard links
â”‚       â”œâ”€â”€ attachment-resolver.js   âœ… Image handling
â”‚       â”œâ”€â”€ transclusion-handler.js  âœ… ![[Embed]] placeholders
â”‚       â”œâ”€â”€ comment-stripper.js      âœ… Privacy protection
â”‚       â””â”€â”€ git-date-extractor.js    âœ… Last modified dates
â”‚
â”œâ”€â”€ content-source/              â† Cloned from GitHub (gitignored)
â”œâ”€â”€ _site/                       â† Eleventy output (gitignored)
â””â”€â”€ docs/                        âœ… Documentation
```

---

## Key Features

### URL Structure
- **Slugs from FILENAME** - Stable URLs even when titles change
- **Folder-based URLs** - `/recipes/challah/`, `/resources/guide/`
- **Slugified paths** - Spaces â†’ hyphens, lowercase (`/lists-of-favorites/`)
- **Titles from first `#` heading** - Display only, preserves formatting

### Publishing Model (Dual Mode)
| Mode | Behavior | Config |
|------|----------|--------|
| **blocklist** (Leon's) | Publish all EXCEPT `#not-for-public` | Current setup |
| **allowlist** | Only publish if `publish: true` | Alternative |

### Link Resolution
- `[[Wiki Links]]` â†’ Resolved to folder-based URLs
- `[text](file.md)` â†’ Resolved to folder-based URLs
- Broken links â†’ `<span class="broken-link">` (doesn't crash build)

### Visualizer Architecture
- Self-contained packages in `lib/visualizers/<name>/`
- Auto-discovery: add a folder â†’ auto-bundled and loaded
- Two types: runtime (browser-only) and build-time (preprocessor + optional browser)
- Pure function design: `parser(md) â†’ data`, `renderer(data) â†’ html`
- See `docs/architecture/visualizers.md` for full details

### Image Optimization
- `@11ty/eleventy-img` via `addTransform` on rendered HTML
- Generates WebP + JPEG at 600w and 1200w
- `<picture>` elements with `loading="lazy"` and `decoding="async"`
- Original 48MB â†’ ~6MB optimized

---

## Environment Variables

```bash
# Required in .env.local (local) and Vercel dashboard (production)
GITHUB_TOKEN=ghp_xxx              # GitHub PAT with repo scope
CONTENT_REPO=LSanten/buffbaby     # Private repo to clone
SITE_URL=https://buffbaby.bloob.haus

# Publishing configuration
PUBLISH_MODE=blocklist            # or "allowlist"
BLOCKLIST_TAG=not-for-public      # Tag that prevents publishing
```

---

## Build Pipeline Flow

```
GitHub (buffbaby)
    â†“ clone-content.js
content-source/
    â†“ preprocess-content.js
    â”‚  â”œâ”€ Strip comments (%% %% and <!-- -->)
    â”‚  â”œâ”€ Filter (#not-for-public)
    â”‚  â”œâ”€ Build index (filename â†’ URL)
    â”‚  â”œâ”€ Resolve [[wiki-links]]
    â”‚  â”œâ”€ Resolve [text](file.md)
    â”‚  â”œâ”€ Resolve images â†’ /media/
    â”‚  â”œâ”€ Handle transclusions
    â”‚  â”œâ”€ Extract git dates
    â”‚  â””â”€ Add layout: layouts/page.njk
src/ (content + media)
    â†“ bundle-visualizers.js (esbuild)
src/assets/ (bundled JS + CSS)
    â†“ eleventy build
    â”‚  â”œâ”€ markdown-it + task-lists plugin
    â”‚  â”œâ”€ Collections (recipes, notes, backlinks)
    â”‚  â”œâ”€ Image optimization transform
    â”‚  â””â”€ Visualizer transforms (build-time)
_site/
    â†“ Vercel
buffbaby.bloob.haus
```

---

## Commands

```bash
# Full build pipeline
npm run build

# Local development (after running build once for content)
npm run dev

# Individual steps (for debugging)
node scripts/clone-content.js
node scripts/preprocess-content.js
node scripts/bundle-visualizers.js
npx @11ty/eleventy
```

---

## Key Technical Decisions

- **Eleventy 3.x with ESM** â€” `"type": "module"`, `export default async function`
- **`setUseGitIgnore(false)`** â€” generated content dirs are gitignored but must be processed
- **`BUILD_TARGET` lazy getter** â€” ESM import timing means module-level env reads are too early
- **Visualizer parsers in preprocessor** â€” receive raw markdown, enabling code sharing with browser/Obsidian
- **`addTransform` for images** â€” post-render HTML modification, no preprocessor changes needed
- **Backlinks via `addCollection`** â€” reads source files from disk, not Eleventy internals

See `docs/implementation-plans/DECISIONS.md` for the full decision log.

---

## What to Do Next

Migration is **COMPLETE**. Remaining cleanup (M7) done.

**Next priorities:**
- Phase 2: Enhanced Linking & API Foundation
- Build-time visualizers (timeline, recipe-card)
- Per-page visualizer activation

See `docs/implementation-plans/ROADMAP.md` for the full roadmap.

---

## Documentation Map

```
docs/
â”œâ”€â”€ CLAUDE_CONTEXT.md           â† This file (quick orientation)
â”œâ”€â”€ CHANGELOG.md                â† Session history & milestones
â”‚
â”œâ”€â”€ architecture/               â† How systems work
â”‚   â”œâ”€â”€ visualizers.md          â† Read/display components
â”‚   â””â”€â”€ magic-machines.md       â† Write/transform AI tools
â”‚
â””â”€â”€ implementation-plans/
    â”œâ”€â”€ ROADMAP.md              â† Phase overview & priorities
    â”œâ”€â”€ DECISIONS.md            â† Architectural decision log
    â”œâ”€â”€ IDEAS.md                â† Future ideas parking lot
    â”‚
    â”œâ”€â”€ _completed/             â† Finished plans (historical)
    â”‚   â””â”€â”€ phase-1-implementation-plan.md
    â”‚
    â””â”€â”€ phases/                 â† Active implementation plans
        â”œâ”€â”€ phase-2-linking-api.md
        â”œâ”€â”€ 2026-02-03_recipe-scaling.md
        â”œâ”€â”€ 2026-02-05_Migration-Checklist.md
        â””â”€â”€ 2026-02-05_Migration-plan-from HUGO to ELEVENTY.md
```

**Naming conventions for new plans:**
- `YYYY-MM-DD_descriptive-name.md` for feature-specific plans

**External reference:** The Obsidian vault `bloobhaus-obsidian` contains the original vision docs including the Vicki engineering report.

---

## Keeping Docs Updated

When making changes, update the relevant docs:

| Change Type | Update |
|-------------|--------|
| New folder structure in codebase | Update "Project Structure" in this file |
| New/changed architecture (visualizers, magic machines, etc.) | Update `architecture/` docs |
| Implementation work on a phase | Update the plan in `phases/` |
| Completed a session | Add to `CHANGELOG.md` |
| Significant technical decision | Add to `DECISIONS.md` |
| New feature idea | Add to `IDEAS.md` |
| Phase-level roadmap changes | Update `ROADMAP.md` |

---

*buffbaby.bloob.haus is LIVE on Eleventy and auto-updating!*
