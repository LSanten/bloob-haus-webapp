{
  "version": 3,
  "sources": ["../../../../lib/visualizers/page-preview/browser.js"],
  "sourcesContent": ["/**\n * Page Preview Visualizer \u2014 Browser Runtime\n *\n * Side effects: DOM manipulation, fetch.\n * This is the only file that touches the DOM or browser APIs.\n *\n * Adds a \"preview\" button to content links across the site.\n * Clicking the button opens a scrollable modal with the page content.\n * The original link still works normally for navigation.\n *\n * Targets:\n * - .recipe-card-link (homepage, list pages)\n * - .tag-page-list li (tag pages)\n * - .pagefind-ui__result (search results, added dynamically)\n */\n(function () {\n  // SVG eye icon for the preview button\n  var EYE_ICON =\n    '<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z\"/><circle cx=\"12\" cy=\"12\" r=\"3\"/></svg>';\n\n  // Create modal elements once\n  var overlay = document.createElement(\"div\");\n  overlay.className = \"preview-overlay\";\n  overlay.innerHTML =\n    '<div class=\"preview-modal\">' +\n    '<button class=\"preview-close\" aria-label=\"Close preview\">&times;</button>' +\n    '<div class=\"preview-content\"></div>' +\n    '<a class=\"preview-goto\" href=\"#\">Go to page</a>' +\n    \"</div>\";\n  document.body.appendChild(overlay);\n\n  var modal = overlay.querySelector(\".preview-modal\");\n  var content = overlay.querySelector(\".preview-content\");\n  var gotoBtn = overlay.querySelector(\".preview-goto\");\n  var closeBtn = overlay.querySelector(\".preview-close\");\n\n  function openPreview(url) {\n    gotoBtn.href = url;\n    content.innerHTML = '<p class=\"preview-loading\">Loading...</p>';\n    overlay.classList.add(\"active\");\n    document.body.style.overflow = \"hidden\";\n\n    fetch(url)\n      .then(function (res) {\n        return res.text();\n      })\n      .then(function (html) {\n        var parser = new DOMParser();\n        var doc = parser.parseFromString(html, \"text/html\");\n        var recipe = doc.querySelector(\".recipe-content\");\n        if (recipe) {\n          content.innerHTML = recipe.innerHTML;\n        } else {\n          var main = doc.querySelector(\".site-main\");\n          content.innerHTML = main\n            ? main.innerHTML\n            : \"<p>Could not load preview.</p>\";\n        }\n        modal.scrollTop = 0;\n      })\n      .catch(function () {\n        content.innerHTML = \"<p>Could not load preview.</p>\";\n      });\n  }\n\n  function closePreview() {\n    overlay.classList.remove(\"active\");\n    document.body.style.overflow = \"\";\n    content.innerHTML = \"\";\n  }\n\n  overlay.addEventListener(\"click\", function (e) {\n    if (e.target === overlay) closePreview();\n  });\n  closeBtn.addEventListener(\"click\", closePreview);\n  document.addEventListener(\"keydown\", function (e) {\n    if (e.key === \"Escape\" && overlay.classList.contains(\"active\"))\n      closePreview();\n  });\n\n  /**\n   * Create a preview button element\n   */\n  function createPreviewBtn(url) {\n    var btn = document.createElement(\"button\");\n    btn.className = \"preview-btn\";\n    btn.setAttribute(\"aria-label\", \"Preview\");\n    btn.setAttribute(\"data-preview-url\", url);\n    btn.innerHTML = EYE_ICON;\n    btn.addEventListener(\"click\", function (e) {\n      e.preventDefault();\n      e.stopPropagation();\n      openPreview(url);\n    });\n    return btn;\n  }\n\n  /**\n   * Add preview buttons to static content (recipe cards, tag page lists)\n   */\n  function addButtonsToStatic() {\n    // Recipe cards on list pages and homepage\n    document.querySelectorAll(\".recipe-card-link\").forEach(function (link) {\n      var url = link.getAttribute(\"href\");\n      if (\n        !url ||\n        !url.startsWith(\"/\") ||\n        url.startsWith(\"/tags/\") ||\n        url.startsWith(\"/search/\")\n      )\n        return;\n      if (link.querySelector(\".preview-btn\")) return;\n      var card = link.querySelector(\".recipe-card\");\n      if (card) {\n        card.style.position = \"relative\";\n        card.appendChild(createPreviewBtn(url));\n      }\n    });\n\n    // Tag page lists\n    document.querySelectorAll(\".tag-page-list li\").forEach(function (li) {\n      var link = li.querySelector(\"a\");\n      if (!link) return;\n      var url = link.getAttribute(\"href\");\n      if (\n        !url ||\n        !url.startsWith(\"/\") ||\n        url.startsWith(\"/tags/\") ||\n        url.startsWith(\"/search/\")\n      )\n        return;\n      if (li.querySelector(\".preview-btn\")) return;\n      li.style.position = \"relative\";\n      li.appendChild(createPreviewBtn(url));\n    });\n  }\n\n  /**\n   * Add preview buttons to Pagefind search results (dynamically rendered)\n   */\n  function addButtonsToSearchResults() {\n    document\n      .querySelectorAll(\".pagefind-ui__result\")\n      .forEach(function (result) {\n        if (result.querySelector(\".preview-btn\")) return;\n        var link = result.querySelector(\".pagefind-ui__result-link\");\n        if (!link) return;\n        var url = link.getAttribute(\"href\");\n        if (\n          !url ||\n          !url.startsWith(\"/\") ||\n          url.startsWith(\"/tags/\") ||\n          url.startsWith(\"/search/\")\n        )\n          return;\n        var inner = result.querySelector(\".pagefind-ui__result-inner\");\n        if (inner) {\n          inner.style.position = \"relative\";\n          inner.appendChild(createPreviewBtn(url));\n        }\n      });\n  }\n\n  // Add buttons on page load\n  addButtonsToStatic();\n\n  // Watch for dynamically added search results\n  var searchEl = document.getElementById(\"search\");\n  if (searchEl) {\n    var observer = new MutationObserver(function () {\n      addButtonsToSearchResults();\n    });\n    observer.observe(searchEl, { childList: true, subtree: true });\n  }\n})();\n"],
  "mappings": "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",
  "names": []
}
